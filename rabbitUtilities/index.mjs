/*! For license information please see index.mjs.LICENSE.txt */
var t={n:e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};const e=require("amqplib");var n=t.n(e);function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,i(r.key),r)}}function i(t){var e=function(t){if("object"!=r(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==r(e)?e:e+""}function c(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}function u(t,e){return t.get(s(t,e))}function a(t,e,n){return t.set(s(t,e),n),n}function s(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}var f=new WeakMap,l=new WeakMap;const p=function(){return t=function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),c(this,f,void 0),c(this,l,void 0),a(f,this,e),a(l,this,n)},e=[{key:"log",value:function(t){var e;arguments.length>1&&void 0!==arguments[1]&&arguments[1]?Array.isArray(arguments)&&arguments.length>0?(e=console).error.apply(e,["!!!! ".concat(u(f,this)," FOR SERVICE: ").concat(u(l,this),": ").concat(t)].concat(Array.prototype.slice.call(arguments))):console.error("!!!! ".concat(u(f,this)," FOR SERVICE: ").concat(u(l,this),": ").concat(t)):console.log("!!!! ".concat(u(f,this)," FOR SERVICE: ").concat(u(l,this),": ").concat(t))}}],e&&o(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function y(t){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y(t)}function b(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var a=r&&r.prototype instanceof u?r:u,s=Object.create(a.prototype);return h(s,"_invoke",function(n,r,o){var i,u,a,s=0,f=o||[],l=!1,p={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(e,n){return i=e,u=0,a=t,p.n=n,c}};function y(n,r){for(u=n,a=r,e=0;!l&&s&&!o&&e<f.length;e++){var o,i=f[e],y=p.p,b=i[2];n>3?(o=b===r)&&(a=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=t):i[0]<=y&&((o=n<2&&y<i[1])?(u=0,p.v=r,p.n=i[1]):y<b&&(o=n<3||i[0]>r||r>b)&&(i[4]=n,i[5]=r,p.n=b,u=0))}if(o||n>1)return c;throw l=!0,r}return function(o,f,b){if(s>1)throw TypeError("Generator is already running");for(l&&1===f&&y(f,b),u=f,a=b;(e=u<2?t:a)||!l;){i||(u?u<3?(u>1&&(p.n=-1),y(u,a)):p.n=a:p.v=a);try{if(s=2,i){if(u||(o="next"),e=i[o]){if(!(e=e.call(i,a)))throw TypeError("iterator result is not an object");if(!e.done)return e;a=e.value,u<2&&(u=0)}else 1===u&&(e=i.return)&&e.call(i),u<2&&(a=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=t}else if((e=(l=p.n<0)?a:n.call(r,p))!==c)break}catch(e){i=t,u=1,a=e}finally{s=1}}return{value:e,done:l}}}(n,o,i),!0),s}var c={};function u(){}function a(){}function s(){}e=Object.getPrototypeOf;var f=[][r]?e(e([][r]())):(h(e={},r,function(){return this}),e),l=s.prototype=u.prototype=Object.create(f);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,h(t,o,"GeneratorFunction")),t.prototype=Object.create(l),t}return a.prototype=s,h(l,"constructor",s),h(s,"constructor",a),a.displayName="GeneratorFunction",h(s,o,"GeneratorFunction"),h(l),h(l,o,"Generator"),h(l,r,function(){return this}),h(l,"toString",function(){return"[object Generator]"}),(b=function(){return{w:i,m:p}})()}function h(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}h=function(t,e,n,r){if(e)o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n;else{var i=function(e,n){h(t,e,function(t){return this._invoke(e,n,t)})};i("next",0),i("throw",1),i("return",2)}},h(t,e,n,r)}function v(t,e,n,r,o,i,c){try{var u=t[i](c),a=u.value}catch(t){return void n(t)}u.done?e(a):Promise.resolve(a).then(r,o)}function m(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var i=t.apply(e,n);function c(t){v(i,r,o,c,u,"next",t)}function u(t){v(i,r,o,c,u,"throw",t)}c(void 0)})}}function g(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,d(r.key),r)}}function d(t){var e=function(t){if("object"!=y(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=y(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==y(e)?e:e+""}function w(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(w=function(){return!!t})()}function O(t){return O=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},O(t)}function S(t,e){return S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},S(t,e)}const E=function(){function t(e,n,r,o){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),(i=function(t,e,n){return e=O(e),function(t,e){if(e&&("object"==y(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,w()?Reflect.construct(e,n||[],O(t).constructor):e.apply(t,n))}(this,t,["RABBITMQ SUBSCRIPTION SERVICE - MESSAGE: ",o])).rabbitUrl=e,i.serviceName=o,i.exchangeName=n,i.queueName=r,i.connection=null,i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&S(t,e)}(t,p),e=t,r=[{key:"endConnection",value:(i=m(b().m(function t(e){return b().w(function(t){for(;;)switch(t.n){case 0:setTimeout(function(){e.close(),process.exit(0)},500);case 1:return t.a(2)}},t)})),function(t){return i.apply(this,arguments)})},{key:"connect",value:(o=m(b().m(function t(e){var r,o=this;return b().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,this.log("subscription attempting to start; exchange=".concat(this.exchangeName,", queue=").concat(this.queueName)),t.n=1,n().connect(this.rabbitUrl);case 1:this.connection=t.v,this.log("Creating channel"),this.connection.createChannel().then(function(t){o.log("Assert Queue"),t.assertQueue(o.queueName,{durable:!0},function(t){o.log("Queue Assertion "),t&&o.log("ERROR ON QUEUE",!0,t)}),o.log("SETTING UP CONSUMER:",o.queueName),t.consume(o.queueName,e,{noAck:!0}),o.log("subscription complete - exchange=".concat(o.exchangeName,", queue=").concat(o.queueName))}),t.n=3;break;case 2:t.p=2,r=t.v,this.log("ERROR connecting to RabbitMQ:",!0,r);case 3:return t.a(2)}},t,this,[[0,2]])})),function(t){return o.apply(this,arguments)})}],r&&g(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,r,o,i}(),j={DEBUG:"35d0c091-14ca-4d5b-8a58-95c6e7e41cd3",INFO:"1754199b-4c7e-431c-91cb-ed1e21a96a45",WARNING:"7cfbd5dd-a746-40b9-b390-4bd9b31cd6df",ERROR:"1fda1a86-3c4c-443d-bd67-ba52244a6040"},P={ConsoleMessage:"c0b744d9-21ef-4dd9-aca1-47e4a5d663be",JsonMessage:"3a5d747e-274d-49ba-88c0-03a6f5268737"},R={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let T;const N=new Uint8Array(16),I=[];for(let t=0;t<256;++t)I.push((t+256).toString(16).slice(1));const _=function(t,e,n){if(R.randomUUID&&!e&&!t)return R.randomUUID();const r=(t=t||{}).random??t.rng?.()??function(){if(!T){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");T=crypto.getRandomValues.bind(crypto)}return T(N)}();if(r.length<16)throw new Error("Random bytes length must be >= 16");if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,e){if((n=n||0)<0||n+16>e.length)throw new RangeError(`UUID byte range ${n}:${n+15} is out of buffer bounds`);for(let t=0;t<16;++t)e[n+t]=r[t];return e}return function(t,e=0){return(I[t[e+0]]+I[t[e+1]]+I[t[e+2]]+I[t[e+3]]+"-"+I[t[e+4]]+I[t[e+5]]+"-"+I[t[e+6]]+I[t[e+7]]+"-"+I[t[e+8]]+I[t[e+9]]+"-"+I[t[e+10]]+I[t[e+11]]+I[t[e+12]]+I[t[e+13]]+I[t[e+14]]+I[t[e+15]]).toLowerCase()}(r)};function U(t){return U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},U(t)}function k(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,C(r.key),r)}}function C(t){var e=function(t){if("object"!=U(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=U(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==U(e)?e:e+""}const G=function(){return t=function t(e,n,r,o,i,c,u,a){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.id=e,this.messageId=null!=n?n:_(),this.createdTimeStamp=null!=r?r:Date.UTC(),Object.values(j).includes(o)?this.logLevel=o:this.invalidLogLevel(o),Object.values(P).includes(i)?this.category=i:this.invalidLogLevel(o),this.message=c,this.publishingService=u,this.consumingService=a},(e=[{key:"invalidLogLevel",value:function(t){throw Error("###".concat(Date.UTC(),"### Invalid Log Level Passed to LogMessage.  LogLevel: ").concat(t,"; MessageId: ").concat(this.messageId,", Publishing Service: ").concat(this.publishingService,";"))}},{key:"toJson",value:function(){var t={id:this.id,messageId:this.messageId,createdTimeStamp:this.createdTimeStamp,logLevel:this.logLevel,category:this.category,message:this.message,publishingService:this.publishingService,consumingService:this.consumingService};return JSON.stringify(t)}},{key:"toLogTableInsert",value:function(){var t={id:this.id,message_id:this.messageId,created_time_stamp:this.createdTimeStamp,level:this.logLevel,category:this.category,message:this.message,publishing_service_name:this.publishingService,consuming_service_name:this.consumingService};return JSON.stringify(t)}}])&&k(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function L(t){return L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},L(t)}function A(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var a=r&&r.prototype instanceof u?r:u,s=Object.create(a.prototype);return x(s,"_invoke",function(n,r,o){var i,u,a,s=0,f=o||[],l=!1,p={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(e,n){return i=e,u=0,a=t,p.n=n,c}};function y(n,r){for(u=n,a=r,e=0;!l&&s&&!o&&e<f.length;e++){var o,i=f[e],y=p.p,b=i[2];n>3?(o=b===r)&&(a=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=t):i[0]<=y&&((o=n<2&&y<i[1])?(u=0,p.v=r,p.n=i[1]):y<b&&(o=n<3||i[0]>r||r>b)&&(i[4]=n,i[5]=r,p.n=b,u=0))}if(o||n>1)return c;throw l=!0,r}return function(o,f,b){if(s>1)throw TypeError("Generator is already running");for(l&&1===f&&y(f,b),u=f,a=b;(e=u<2?t:a)||!l;){i||(u?u<3?(u>1&&(p.n=-1),y(u,a)):p.n=a:p.v=a);try{if(s=2,i){if(u||(o="next"),e=i[o]){if(!(e=e.call(i,a)))throw TypeError("iterator result is not an object");if(!e.done)return e;a=e.value,u<2&&(u=0)}else 1===u&&(e=i.return)&&e.call(i),u<2&&(a=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=t}else if((e=(l=p.n<0)?a:n.call(r,p))!==c)break}catch(e){i=t,u=1,a=e}finally{s=1}}return{value:e,done:l}}}(n,o,i),!0),s}var c={};function u(){}function a(){}function s(){}e=Object.getPrototypeOf;var f=[][r]?e(e([][r]())):(x(e={},r,function(){return this}),e),l=s.prototype=u.prototype=Object.create(f);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,x(t,o,"GeneratorFunction")),t.prototype=Object.create(l),t}return a.prototype=s,x(l,"constructor",s),x(s,"constructor",a),a.displayName="GeneratorFunction",x(s,o,"GeneratorFunction"),x(l),x(l,o,"Generator"),x(l,r,function(){return this}),x(l,"toString",function(){return"[object Generator]"}),(A=function(){return{w:i,m:p}})()}function x(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}x=function(t,e,n,r){if(e)o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n;else{var i=function(e,n){x(t,e,function(t){return this._invoke(e,n,t)})};i("next",0),i("throw",1),i("return",2)}},x(t,e,n,r)}function M(t,e,n,r,o,i,c){try{var u=t[i](c),a=u.value}catch(t){return void n(t)}u.done?e(a):Promise.resolve(a).then(r,o)}function q(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var i=t.apply(e,n);function c(t){M(i,r,o,c,u,"next",t)}function u(t){M(i,r,o,c,u,"throw",t)}c(void 0)})}}function B(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Q(r.key),r)}}function Q(t){var e=function(t){if("object"!=L(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=L(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==L(e)?e:e+""}function D(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(D=function(){return!!t})()}function F(t){return F=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},F(t)}function V(t,e){return V=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},V(t,e)}const J=function(){function t(e,n,r,o){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),(i=function(t,e,n){return e=F(e),function(t,e){if(e&&("object"==L(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,D()?Reflect.construct(e,n||[],F(t).constructor):e.apply(t,n))}(this,t,["RABBITMQ PUBLICATION SERVICE - MESSAGE: ",o])).rabbitUrl=e,i.serviceName=o,i.exchangeName=n,i.queueName=r,i.connection=null,i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&V(t,e)}(t,p),e=t,r=[{key:"publish",value:(i=q(A().m(function t(e){var n,r,o,i,c,u,a=arguments;return A().w(function(t){for(;;)switch(t.p=t.n){case 0:if(n=a.length>1&&void 0!==a[1]?a[1]:"undefined",r=a.length>2&&void 0!==a[2]?a[2]:j.DEBUG,o=a.length>3&&void 0!==a[3]?a[3]:P.JsonMessage,this.connection){t.n=1;break}return t.n=1,this.connect();case 1:return t.p=1,this.log("CREATING LOG MESSAGE"),i=new G(null,null,null,r,o,e,this.serviceName,n),c=i.toJson(),this.log("PUBLISHING MESSAGE: ",c),t.n=2,this.connect.sendToQueue(this.queueName,Buffer.from(c));case 2:this.log("SETUP PUBLICATION complete - exchange=".concat(this.exchangeName,", queue=").concat(this.queueName)),t.n=4;break;case 3:t.p=3,u=t.v,this.log("ERROR publishing to RabbitMQ:",!0,u);case 4:return t.a(2)}},t,this,[[1,3]])})),function(t){return i.apply(this,arguments)})},{key:"connect",value:(o=q(A().m(function t(){var e,r=this;return A().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,this.log("publication attempting to start; exchange=".concat(this.exchangeName,", queue=").concat(this.queueName)),t.n=1,n().connect(this.rabbitUrl);case 1:return this.connection=t.v,this.log("Creating channel"),t.n=2,this.connection.createChannel().then(function(t){r.log("Asserting Queue"),t.assertQueue(r.queueName,{durable:!0},function(t){r.log("Queue Assertion "),t&&r.log("ERROR ON QUEUE",!0,t)})});case 2:t.n=4;break;case 3:t.p=3,e=t.v,this.log("ERROR connecting to RabbitMQ:",!0,e);case 4:return t.a(2)}},t,this,[[0,3]])})),function(){return o.apply(this,arguments)})}],r&&B(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,r,o,i}(),W={workhorseApi:"WFH-INATOR-WORKHORSE-API",loggingService:"WFH-INATOR-LOGGING-SERVICE"},H=function(){return{Subscription:E,Publication:J,LogLevel:j,LogCategory:P,ServiceName:W,LogMessage:G}};export{H as default};